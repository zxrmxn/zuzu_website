<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>[Prototype] Smart Greenhouse | Zuharman</title>
<meta name="keywords" content="IoT, Hardware">
<meta name="description" content="A smart IoT device to help run a hydroponic greenhouse more smoothly. The device comes with sensors that check temperature, humidity, and the level of dissolved solids (TDS) in the water that’s used to feed the plants. If the temperature inside the greenhouse gets too high, the device will automatically turn on a fan to cool it down. All of this runs on its own—no need to constantly check things manually. It’s basically like having an automatic assistant that helps keep the greenhouse environment just right, making things easier and more efficient for the people running it.">
<meta name="author" content="Zuharman">
<link rel="canonical" href="//localhost:1313/posts/smartgreenhouse/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.cff8f7aa99d2666fd53666ba9717f2d8e088ea48afa81a0055cdd113a45754eb.css" integrity="sha256-z/j3qpnSZm/VNma6lxfy2OCI6kivqBoAVc3RE6RXVOs=" rel="preload stylesheet" as="style">


<link rel="stylesheet" href="/highlightjs/github.min.css" media="(prefers-color-scheme: light)">
<link rel="stylesheet" href="/highlightjs/github-dark.min.css" media="(prefers-color-scheme: dark)">



<script src="/highlightjs/highlight.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll('pre code').forEach((block) => {
      hljs.highlightElement(block);
    });
  });
</script>
<link rel="icon" href="//localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="//localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="//localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="//localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="//localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="//localhost:1313/posts/smartgreenhouse/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap"rel="stylesheet">
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="//localhost:1313/" accesskey="h" title="Zuharman (Alt + H)">Zuharman</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="//localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/posts/" title="Blogs">
                    <span>Blogs</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/documents/resume_zuharman.pdf" title="Resume">
                    <span>Resume</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="//localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="//localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      [Prototype] Smart Greenhouse
    </h1>
    <div class="post-meta"><span title='2025-05-05 20:11:08 +0700 +07'>May 5, 2025</span>&nbsp;·&nbsp;Zuharman

</div>
  </header> 
<figure class="entry-cover">
        <img loading="eager" src="//localhost:1313/images/greenhouse.png" alt="">
        
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#tools" aria-label="Tools"><strong>Tools</strong></a></li>
                    <li>
                        <a href="#codes" aria-label="Codes"><strong>Codes</strong></a><ul>
                            
                    <li>
                        <a href="#include-libraries" aria-label="Include libraries">Include libraries</a></li>
                    <li>
                        <a href="#initializing-internet-connection" aria-label="Initializing Internet Connection">Initializing Internet Connection</a></li>
                    <li>
                        <a href="#define-pin-to-connect-to-dht-sensor" aria-label="Define Pin to connect to DHT Sensor">Define Pin to connect to DHT Sensor</a></li>
                    <li>
                        <a href="#define-dht-type" aria-label="Define DHT type">Define DHT type</a></li>
                    <li>
                        <a href="#initialize-pin-for-relay" aria-label="Initialize pin for relay">Initialize pin for relay</a></li>
                    <li>
                        <a href="#set-relay-off-when-startup" aria-label="Set relay off when startup">Set relay off when startup</a></li>
                    <li>
                        <a href="#read-data-from-dht-sensor" aria-label="Read data from DHT sensor">Read data from DHT sensor</a></li>
                    <li>
                        <a href="#relay-condition" aria-label="Relay Condition">Relay Condition</a></li>
                    <li>
                        <a href="#print-dht22-value" aria-label="Print DHT22 value">Print DHT22 value</a></li>
                    <li>
                        <a href="#define-tds-sensor" aria-label="Define TDS Sensor">Define TDS Sensor</a></li>
                    <li>
                        <a href="#create-buffer" aria-label="Create buffer">Create buffer</a></li>
                    <li>
                        <a href="#analog-sampling-and-data-processing" aria-label="Analog Sampling and Data Processing">Analog Sampling and Data Processing</a></li>
                    <li>
                        <a href="#calculate-the-median-using-bubble-sort" aria-label="Calculate the median using bubble sort">Calculate the median using bubble sort</a></li></ul>
                    </li>
                    <li>
                        <a href="#references" aria-label="References">References</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><p>A smart IoT device to help run a hydroponic greenhouse more smoothly. The device comes with sensors that check temperature, humidity, and the level of dissolved solids (TDS) in the water that’s used to feed the plants. If the temperature inside the greenhouse gets too high, the device will automatically turn on a fan to cool it down. All of this runs on its own—no need to constantly check things manually. It’s basically like having an automatic assistant that helps keep the greenhouse environment just right, making things easier and more efficient for the people running it.</p>
<p>Link: <a href="https://github.com/zxrmxn/SmartGreenhouse">https://github.com/zxrmxn/SmartGreenhouse</a></p>
<hr>
<h3 id="tools"><strong>Tools</strong><a hidden class="anchor" aria-hidden="true" href="#tools">#</a></h3>
<table>
  <thead>
      <tr>
          <th><strong>Hardware</strong></th>
          <th><strong>Description</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>NodeMCU</td>
          <td>Microcontroller</td>
      </tr>
      <tr>
          <td>DHT22</td>
          <td>Temp and Moisture Sensor</td>
      </tr>
      <tr>
          <td>TDS Sensor</td>
          <td>Dissolved Solid Water Level</td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th><strong>Software</strong></th>
          <th><strong>Description</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Arduino IDE</td>
          <td>Microcontroller</td>
      </tr>
      <tr>
          <td>ThingSpeak</td>
          <td>Devices Data Stream and Store It</td>
      </tr>
      <tr>
          <td>Weebly</td>
          <td>Web Builder</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="codes"><strong>Codes</strong><a hidden class="anchor" aria-hidden="true" href="#codes">#</a></h3>
<h4 id="include-libraries">Include libraries<a hidden class="anchor" aria-hidden="true" href="#include-libraries">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-arduino" data-lang="arduino"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;DHT.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;WiFi.h&gt;</span><span style="color:#75715e">
</span></span></span></code></pre></div><h4 id="initializing-internet-connection">Initializing Internet Connection<a hidden class="anchor" aria-hidden="true" href="#initializing-internet-connection">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-arduino" data-lang="arduino"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>ssid<span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;WiFi SSID&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>pass<span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;WiFi Password&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>server<span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ThingSpeak API&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WiFi</span>.<span style="color:#a6e22e">begin</span> (ssid, pass);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">WiFi</span>.status() <span style="color:#f92672">!=</span> WL_CONNECTED) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">delay</span>(<span style="color:#ae81ff">500</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">print</span>(.)<span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;WiFi Connected&#34;</span>);
</span></span></code></pre></div><h4 id="define-pin-to-connect-to-dht-sensor">Define Pin to connect to DHT Sensor<a hidden class="anchor" aria-hidden="true" href="#define-pin-to-connect-to-dht-sensor">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-arduino" data-lang="arduino"><span style="display:flex;"><span><span style="color:#75715e">#define DHTPIN 2 </span><span style="color:#75715e">// Pin connected to DHT Sensor
</span></span></span></code></pre></div><h4 id="define-dht-type">Define DHT type<a hidden class="anchor" aria-hidden="true" href="#define-dht-type">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-arduino" data-lang="arduino"><span style="display:flex;"><span><span style="color:#75715e">// Uncomment whatever type you&#39;re using!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//#define DHTTYPE DHT11   // DHT 11
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define DHTTYPE DHT22   </span><span style="color:#75715e">// DHT 22  (AM2302), AM2321
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//#define DHTTYPE DHT21   // DHT 21 (AM2301)
</span></span></span></code></pre></div><h4 id="initialize-pin-for-relay">Initialize pin for relay<a hidden class="anchor" aria-hidden="true" href="#initialize-pin-for-relay">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-arduino" data-lang="arduino"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> relay1 <span style="color:#f92672">=</span> D0; <span style="color:#75715e">// Pin2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> relay2 <span style="color:#f92672">=</span> D1; <span style="color:#75715e">// Pin3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> relay3 <span style="color:#f92672">=</span> D2; <span style="color:#75715e">// Pin4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> relay4 <span style="color:#f92672">=</span> D3; <span style="color:#75715e">// Pin5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> relayON <span style="color:#f92672">=</span> <span style="color:#66d9ef">LOW</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> relayOFF <span style="color:#f92672">=</span> <span style="color:#66d9ef">HIGH</span>;
</span></span></code></pre></div><h4 id="set-relay-off-when-startup">Set relay off when startup<a hidden class="anchor" aria-hidden="true" href="#set-relay-off-when-startup">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-arduino" data-lang="arduino"><span style="display:flex;"><span><span style="color:#a6e22e">pinMode</span> (relay1, <span style="color:#66d9ef">OUTPUT</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">pinMode</span> (relay2, <span style="color:#66d9ef">OUTPUT</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">pinMode</span> (relay3, <span style="color:#66d9ef">OUTPUT</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">pinMode</span> (relay4, <span style="color:#66d9ef">OUTPUT</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">digitalWrite</span> (relay1, relayOFF);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">digitalWrite</span> (relay2, relayOFF);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">digitalWrite</span> (relay3, relayOFF);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">digitalWrite</span> (relay4, relayOFF);
</span></span></code></pre></div><h4 id="read-data-from-dht-sensor">Read data from DHT sensor<a hidden class="anchor" aria-hidden="true" href="#read-data-from-dht-sensor">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-arduino" data-lang="arduino"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loop</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">delay</span> (<span style="color:#ae81ff">2000</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> humidity <span style="color:#f92672">=</span> dht.readHumidity();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> temperature <span style="color:#f92672">=</span> dht.<span style="color:#a6e22e">readTemperature</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> hix <span style="color:#f92672">=</span> dht.computeHeatIndex(temperature, humidity, false);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="relay-condition">Relay Condition<a hidden class="anchor" aria-hidden="true" href="#relay-condition">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-arduino" data-lang="arduino"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (temperature <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">30</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">digitalWrite</span> (relay1, relayON);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">delay</span>(<span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">digitalWrite</span> (relay1, relayOFF);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">delay</span>(<span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="print-dht22-value">Print DHT22 value<a hidden class="anchor" aria-hidden="true" href="#print-dht22-value">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-arduino" data-lang="arduino"><span style="display:flex;"><span>(<span style="color:#a6e22e">isnan</span>(h) <span style="color:#f92672">||</span> <span style="color:#a6e22e">isnan</span>(t) <span style="color:#f92672">||</span> <span style="color:#a6e22e">isnan</span>(f)) {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">println</span>(F(<span style="color:#e6db74">&#34;Failed to read from DHT sensor!&#34;</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">print</span>(F(<span style="color:#e6db74">&#34;Humidity: &#34;</span>));
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">print</span>(humidity);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">print</span>(F(<span style="color:#e6db74">&#34;%  Temperature: &#34;</span>));
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">print</span>(temperature);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">print</span>(F(<span style="color:#e6db74">&#34;°C &#34;</span>));
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">print</span>(f);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">print</span>(F(<span style="color:#e6db74">&#34;°F  Heat index: &#34;</span>));
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">print</span>(hix);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">print</span>(F(<span style="color:#e6db74">&#34;°C &#34;</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="define-tds-sensor">Define TDS Sensor<a hidden class="anchor" aria-hidden="true" href="#define-tds-sensor">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-arduino" data-lang="arduino"><span style="display:flex;"><span><span style="color:#75715e">#define TdsSensorPin A0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define VREF 5.0 </span><span style="color:#75715e">// analog reference voltage(Volt) of the ADC
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#define SCOUNT 30 </span><span style="color:#75715e">// sum of sample point
</span></span></span></code></pre></div><h4 id="create-buffer">Create buffer<a hidden class="anchor" aria-hidden="true" href="#create-buffer">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-arduino" data-lang="arduino"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> analogBuffer[SCOUNT]; <span style="color:#75715e">// store the analog value in the array, read from ADC
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> analogBufferTemp[SCOUNT]; <span style="color:#75715e">// a temporary copy of analogBuffer, used for processing.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> analogBufferIndex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,copyIndex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">float</span> averageVoltage <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,tdsValue <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,temperature <span style="color:#f92672">=</span> <span style="color:#ae81ff">25</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// averageVoltage: Stores the filtered average voltage value from the sensor (in volts).
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// tdsValue: The final computed Total Dissolved Solids value (in ppm).
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// temperature: Used for temperature compensation of the TDS reading. It&#39;s fixed at 25°C by default (you can replace it with a real-time temperature sensor if available).
</span></span></span></code></pre></div><h4 id="analog-sampling-and-data-processing">Analog Sampling and Data Processing<a hidden class="anchor" aria-hidden="true" href="#analog-sampling-and-data-processing">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-arduino" data-lang="arduino"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">begin</span>(<span style="color:#ae81ff">115200</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pinMode</span>(TdsSensorPin,<span style="color:#66d9ef">INPUT</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loop</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> analogSampleTimepoint <span style="color:#f92672">=</span> <span style="color:#a6e22e">millis</span>();
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">millis</span>()<span style="color:#f92672">-</span>analogSampleTimepoint <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">40U</span>) <span style="color:#75715e">//every 40 milliseconds,read the analog value from the ADC
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   {
</span></span><span style="display:flex;"><span>     analogSampleTimepoint <span style="color:#f92672">=</span> <span style="color:#a6e22e">millis</span>();
</span></span><span style="display:flex;"><span>     analogBuffer[analogBufferIndex] <span style="color:#f92672">=</span> <span style="color:#a6e22e">analogRead</span>(TdsSensorPin); <span style="color:#75715e">//read the analog value and store into the buffer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>     analogBufferIndex<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">if</span>(analogBufferIndex <span style="color:#f92672">==</span> SCOUNT) 
</span></span><span style="display:flex;"><span>         analogBufferIndex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>   }   
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> printTimepoint <span style="color:#f92672">=</span> <span style="color:#a6e22e">millis</span>();
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">millis</span>()<span style="color:#f92672">-</span>printTimepoint <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">800U</span>)
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>      printTimepoint <span style="color:#f92672">=</span> <span style="color:#a6e22e">millis</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span>(copyIndex<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;copyIndex<span style="color:#f92672">&lt;</span>SCOUNT;copyIndex<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>        analogBufferTemp[copyIndex]<span style="color:#f92672">=</span> analogBuffer[copyIndex];
</span></span><span style="display:flex;"><span>      averageVoltage <span style="color:#f92672">=</span> getMedianNum(analogBufferTemp,SCOUNT) <span style="color:#f92672">*</span> (<span style="color:#66d9ef">float</span>)VREF <span style="color:#f92672">/</span> <span style="color:#ae81ff">1024.0</span>; <span style="color:#75715e">// read the analog value more stable by the median filtering algorithm, and convert to voltage value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">float</span> compensationCoefficient<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span><span style="color:#f92672">+</span><span style="color:#ae81ff">0.02</span><span style="color:#f92672">*</span>(temperature<span style="color:#f92672">-</span><span style="color:#ae81ff">25.0</span>); <span style="color:#75715e">//temperature compensation formula: fFinalResult(25^C) = fFinalResult(current)/(1.0+0.02*(fTP-25.0));
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">float</span> compensationVolatge<span style="color:#f92672">=</span>averageVoltage<span style="color:#f92672">/</span>compensationCoefficient; <span style="color:#75715e">//temperature compensation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      tdsValue<span style="color:#f92672">=</span>(<span style="color:#ae81ff">133.42</span><span style="color:#f92672">*</span>compensationVolatge<span style="color:#f92672">*</span>compensationVolatge<span style="color:#f92672">*</span>compensationVolatge <span style="color:#f92672">-</span> <span style="color:#ae81ff">255.86</span><span style="color:#f92672">*</span>compensationVolatge<span style="color:#f92672">*</span>compensationVolatge <span style="color:#f92672">+</span> <span style="color:#ae81ff">857.39</span><span style="color:#f92672">*</span>compensationVolatge)<span style="color:#f92672">*</span><span style="color:#ae81ff">0.5</span>; <span style="color:#75715e">//convert voltage value to tds value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">//Serial.print(&#34;voltage:&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">//Serial.print(averageVoltage,2);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">//Serial.print(&#34;V   &#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">print</span>(<span style="color:#e6db74">&#34;TDS Value:&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">print</span>(tdsValue,<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">Serial</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;ppm&#34;</span>);
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="calculate-the-median-using-bubble-sort">Calculate the median using bubble sort<a hidden class="anchor" aria-hidden="true" href="#calculate-the-median-using-bubble-sort">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-arduino" data-lang="arduino"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getMedianNum</span>(<span style="color:#66d9ef">int</span> bArray[], <span style="color:#66d9ef">int</span> iFilterLen) 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> bTab[iFilterLen];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">byte</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i<span style="color:#f92672">&lt;</span>iFilterLen; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>      bTab[i] <span style="color:#f92672">=</span> bArray[i];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> i, j, bTemp;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> iFilterLen <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; j<span style="color:#f92672">++</span>) 
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> iFilterLen <span style="color:#f92672">-</span> j <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; i<span style="color:#f92672">++</span>) 
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (bTab[i] <span style="color:#f92672">&gt;</span> bTab[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]) 
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>        bTemp <span style="color:#f92672">=</span> bTab[i];
</span></span><span style="display:flex;"><span>            bTab[i] <span style="color:#f92672">=</span> bTab[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        bTab[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> bTemp;
</span></span><span style="display:flex;"><span>         }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ((iFilterLen <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    bTemp <span style="color:#f92672">=</span> bTab[(iFilterLen <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    bTemp <span style="color:#f92672">=</span> (bTab[iFilterLen <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>] <span style="color:#f92672">+</span> bTab[iFilterLen <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> bTemp;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<h3 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">#</a></h3>
<ul>
<li>DHT Sensor Library: <a href="https://github.com/adafruit/DHT-sensor-library">https://github.com/adafruit/DHT-sensor-library</a></li>
<li>Adafruit Unified Sensor Lib: <a href="https://github.com/adafruit/Adafruit_Sensor">https://github.com/adafruit/Adafruit_Sensor</a></li>
<li>TDS Sensor: <a href="https://wiki.dfrobot.com/Gravity__Analog_TDS_Sensor___Meter_For_Arduino_SKU__SEN0244">https://wiki.dfrobot.com/Gravity__Analog_TDS_Sensor___Meter_For_Arduino_SKU__SEN0244</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="//localhost:1313/tags/iot/">IoT</a></li>
      <li><a href="//localhost:1313/tags/hardware/">Hardware</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="//localhost:1313/">Zuharman</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
